<!-- poApproval.html -->
<style>
  .po-row { display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; }
  .btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
  .btn-approve{ background:#16a34a;color:#fff }
  .btn-reject{ background:#ef4444;color:#fff }
</style>

<div class="card">
  <h3>Pending PO Approvals</h3>
  <div id="list">
    <? if (pending && pending.length>0) { ?>
      <? for (let i=0;i<pending.length;i++){ let p = pending[i]; ?>
        <div class="po-row" id="po-<?= p.poId ?>">
          <div>
            <strong><?= p.poId ?></strong> (PR: <?= p.prId || 'N/A' ?>) — <?= p.site ?> — ₹<?= Number(p.totalValue).toFixed(2) ?>
          </div>
          <div>
            <button class="btn btn-approve" onclick="decide('<?= p.poId ?>','Approved')">Approve</button>
            <button class="btn btn-reject" onclick="decide('<?= p.poId ?>','Rejected')">Reject</button>
          </div>
        </div>
      <? } ?>
    <? } else { ?>
      <div>No POs pending approval</div>
    <? } ?>
  </div>
</div>

<script>
  function decide(poId, action) {
    const remarks = action==='Rejected' ? prompt("Remarks (required)") : prompt("Any remarks?");
    if (action==='Rejected' && !remarks) return alert("Remarks required");
    google.script.run.withSuccessHandler(function(){ document.getElementById('po-' + poId).remove(); }).withFailureHandler(function(e){ alert(e.message); }).processPOApproval(poId, action, remarks);
  }
</script>
